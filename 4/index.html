<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Image Warping & Mosaicing</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root{
      --ink:#222; --muted:#555; --bg:#fdfdfd; --card:#fff;
      --accent:#007acc; --accent2:#005fa3; --soft:#f0f8ff; --rule:#ddd;
    }
    *{box-sizing:border-box}
    body{
      font-family: "Segoe UI", Arial, sans-serif;
      margin: 28px;
      line-height: 1.6;
      background: var(--bg);
      color: var(--ink);
    }
    h1{
      text-align:center; margin: 0 0 26px; font-size: 2.25rem; letter-spacing:.3px;
    }
    h2{
      margin: 42px 0 12px;
      font-size: 1.6rem; font-weight: 700; color:#005fa3;
      border-left: 8px solid var(--accent);
      background: linear-gradient(to right, var(--soft), #fff);
      padding: 8px 12px; border-radius: 6px;
    }
    h3{ margin: 16px 0 10px; }
    p{ margin: 10px 0 12px; }
    small{ color:var(--muted); }
    .pill{ display:inline-block; background:#eef6ff; color:#084b83; border:1px solid #d7eaff; padding:.2em .6em; border-radius:999px; font-size:.85em; }

    .row{ display:flex; flex-wrap:wrap; gap:18px; align-items:flex-start; }
    .pair{ display:grid; grid-template-columns: 1fr 1fr; gap:18px; }
    @media (max-width: 1100px){ .pair{ grid-template-columns: 1fr; } }

    figure{
      margin:0; background:var(--card); border:1px solid var(--rule);
      border-radius:12px; padding:14px; box-shadow:2px 2px 8px rgba(0,0,0,.08);
    }
    figcaption{ margin-top:8px; color:var(--muted); font-size:.95rem; }

    .big img{ width:100%; max-width: 820px; height:auto; border-radius:8px; border:1px solid #eee; }
    .huge img{ width:100%; max-width: 980px; height:auto; border-radius:8px; border:1px solid #eee; }
    .wide img{ width:100%; max-width: 1000px; height:auto; border-radius:8px; border:1px solid #eee; }

    ul{ margin: 8px 0 0 18px; }
    .footer{ margin-top:40px; padding-top:14px; border-top:1px solid var(--rule); display:flex; gap:10px; flex-wrap:wrap; }
    a.button{
      display:inline-block; text-decoration:none; color:#fff; background:var(--accent);
      padding:10px 16px; border-radius:10px; font-weight:700;
    }
    a.button:hover{ background:var(--accent2); }

    pre{
      background:#fafafa; border:1px solid #eee; padding:12px; border-radius:8px; overflow:auto;
      font-size:.92rem; line-height:1.35;
    }
  </style>

  <script>
    MathJax = {
      tex: {
        inlineMath: [['\\(','\\)'], ['$', '$']],
        displayMath: [['\\[','\\]'], ['$$','$$']]
      },
      options: { skipHtmlTags: ['script','noscript','style','textarea','pre','code'] }
    };
  </script>
  <script defer src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>
<body>

  <h1>Image Warping & Mosaicing</h1>

  <h2>Overview</h2>
  <p>
    Pipeline:
    <span class="pill">A.1</span> capture projectively related images (rotate in place),
    <span class="pill">A.2</span> estimate homographies from correspondences,
    <span class="pill">A.3</span> inverse warp with nearest &amp; bilinear (plus rectification),
    <span class="pill">A.4</span> feather-blend into mosaics;
    <span class="pill">B.1</span> Harris corner detection + ANMS,
    <span class="pill">B.2</span> 40×40 → 8×8 normalized descriptors,
    <span class="pill">B.3</span> Lowe-ratio feature matching,
    <span class="pill">B.4</span> 4-point RANSAC homography &amp; automatic mosaics.
  </p>

  <!-- ====================== A.1 ====================== -->
  <h2>A.1 — Shoot the Pictures</h2>
  <p>Each set below shows a pair of photos , captured by rotating about a fixed COP with about a 70% overlap.</p>

  <!-- Set 1: pair (JPG) -->
  <h3>Set 1</h3>
  <div class="pair">
    <figure class="huge">
      <img src="./media/a1_set1_img1.jpg" alt="A.1 Set 1 image 1">
      <figcaption>Set 1 — Image 1 (JPG)</figcaption>
    </figure>
    <figure class="huge">
      <img src="./media/a1_set1_img2.jpg" alt="A.1 Set 1 image 2">
      <figcaption>Set 1 — Image 2 (JPG)</figcaption>
    </figure>
  </div>

  <!-- Set 2: pair (JPG) -->
  <h3>Set 2</h3>
  <div class="pair">
    <figure class="huge">
      <img src="./media/a1_set2_img1.jpg" alt="A.1 Set 2 image 1">
      <figcaption>Set 2 — Image 1 (JPG)</figcaption>
    </figure>
    <figure class="huge">
      <img src="./media/a1_set2_img2.jpg" alt="A.1 Set 2 image 2">
      <figcaption>Set 2 — Image 2 (JPG)</figcaption>
    </figure>
  </div>

  <!-- Set 3: pair (JPG) -->
  <h3>Set 3</h3>
  <div class="pair">
    <figure class="huge">
      <img src="./media/a1_set3_img1.jpg" alt="A.1 Set 3 image 1">
      <figcaption>Set 3 — Image 1 (JPG)</figcaption>
    </figure>
    <figure class="huge">
      <img src="./media/a1_set3_img2.jpg" alt="A.1 Set 3 image 2">
      <figcaption>Set 3 — Image 2 (JPG)</figcaption>
    </figure>
  </div>

  <!-- ====================== A.2 ====================== -->
  <h2>A.2 — Recover Homographies</h2>
  <p>
    For each image pair, I manually clicked four correspondences and solved the linear system
    \(A\,h=b\) in least squares to obtain the homography \(H\).
    The homography maps homogeneous points between images and preserves straight lines.
    Below are example overlays and the computed matrices.
  </p>

  <div class="row">
    <figure class="big">
      <img src="./media/a2_pair1_points.png" alt="A.2 Pair 1 correspondences (large)">
      <figcaption>Pair 1 overlay (large).</figcaption>
    </figure>
  </div>
  <pre>
H (im1→im2):
[[ 4.25602000e-01 -8.63586000e-01  1.29503066e+03]
 [ 2.25027000e-01 -8.43065000e-01  2.00623841e+03]
 [ 8.90000000e-05 -4.17000000e-04  1.00000000e+00]]

Model per point:
u = (a x + b y + c) / (g x + h y + 1)
v = (d x + e y + f) / (g x + h y + 1)

System rows (A·h=b):
[3085.46 2636.05 1   0      0      0   -1883.72*3085.46  -1883.72*2636.05] · [a,b,c,d,e,f,g,h]^T = 1883.72
[0      0      0  3085.46 2636.05 1   -2715.17*3085.46  -2715.17*2636.05] · [a,b,c,d,e,f,g,h]^T = 2715.17
[4222.92 2665.72 1   0      0      0   -2981.61*4222.92  -2981.61*2665.72] · [a,b,c,d,e,f,g,h]^T = 2981.61
[0      0      0  4222.92 2665.72 1   -2675.61*4222.92  -2675.61*2665.72] · [a,b,c,d,e,f,g,h]^T = 2675.61
[2729.39 2458.01 1   0      0      0   -1527.65*2729.39  -1527.65*2458.01] · [a,b,c,d,e,f,g,h]^T = 1527.65
[0      0      0  2729.39 2458.01 1   -2507.46*2729.39  -2507.46*2458.01] · [a,b,c,d,e,f,g,h]^T = 2507.46
[3134.92 2428.34 1   0      0      0   -1992.52*3134.92  -1992.52*2428.34] · [a,b,c,d,e,f,g,h]^T = 1992.52
[0      0      0  3134.92 2428.34 1   -2487.68*3134.92  -2487.68*2428.34] · [a,b,c,d,e,f,g,h]^T = 2487.68
  </pre>

  <div class="row">
    <figure class="big">
      <img src="./media/a2_pair2_points.png" alt="A.2 Pair 2 correspondences (large)">
      <figcaption>Pair 2 overlay (large).</figcaption>
    </figure>
  </div>
  <pre>
H (im1→im2):
[[ 5.00149000e-01 -5.09250000e-02  1.95248538e+03]
 [-1.95654000e-01  7.77235000e-01  4.05135920e+02]
 [-8.60000000e-05 -1.00000000e-05  1.00000000e+00]]

Model per point:
u = (a x + b y + c) / (g x + h y + 1)
v = (d x + e y + f) / (g x + h y + 1)

System rows (A·h=b):
[642.41 3397.65 1   0      0      0   -2309.03*642.41  -2309.03*3397.65] · [a,b,c,d,e,f,g,h]^T = 2309.03
[0      0      0   642.41 3397.65 1   -3209.72*642.41  -3209.72*3397.65] · [a,b,c,d,e,f,g,h]^T = 3209.72
[1483.14 1310.66 1   0      0      0   -3060.74*1483.14  -3060.74*1310.66] · [a,b,c,d,e,f,g,h]^T = 3060.74
[0      0      0  1483.14 1310.66 1   -1320.55*1483.14  -1320.55*1310.66] · [a,b,c,d,e,f,g,h]^T = 1320.55
[2333.75 1152.41 1   0      0      0   -3891.57*2333.75  -3891.57*1152.41] · [a,b,c,d,e,f,g,h]^T = 3891.57
[0      0      0  2333.75 1152.41 1   -1073.28*2333.75  -1073.28*1152.41] · [a,b,c,d,e,f,g,h]^T = 1073.28
[1552.37 4000.99 1   0      0      0   -3060.74*1552.37  -3060.74*4000.99] · [a,b,c,d,e,f,g,h]^T = 3060.74
[0      0      0  1552.37 4000.99 1   -3892.19*1552.37  -3892.19*4000.99] · [a,b,c,d,e,f,g,h]^T = 3892.19
  </pre>

  <!-- ====================== A.3 ====================== -->
  <h2>A.3 — Warp & Rectify</h2>
  <div class="pair">
    <figure class="big">
      <img src="./media/a3_before_left.jpg" alt="A.3 before left">
      <figcaption>Before (Left)</figcaption>
    </figure>
    <figure class="big">
      <img src="./media/a3_before_right.jpg" alt="A.3 before right">
      <figcaption>Before (Right)</figcaption>
    </figure>
  </div>

  <div class="row" style="margin-top:12px;">
    <figure class="wide">
      <img src="./media/a3_rect_combined.png" alt="A.3 combined rectified results">
      <figcaption>After (Combined Rectified Results)</figcaption>
    </figure>
  </div>

  <!-- ====================== A.4 ====================== -->
  <h2>A.4 — Mosaic Blending</h2>
  <div class="row">
    <figure class="big">
      <img src="./media/a4_mosaic1.png" alt="Mosaic 1">
      <figcaption>Mosaic 1</figcaption>
    </figure>
  </div>
  <div class="row">
    <figure class="big">
      <img src="./media/a4_mosaic2.png" alt="Mosaic 2">
      <figcaption>Mosaic 2</figcaption>
    </figure>
  </div>
  <div class="row">
    <figure class="big">
      <img src="./media/a4_mosaic3.png" alt="Mosaic 3">
      <figcaption>Mosaic 3</figcaption>
    </figure>
  </div>

  <!-- ====================== B.1 ====================== -->
  <h2>B.1 — Harris Corner Detection + ANMS</h2>
  <p>
    I detect interest points using a single-scale Harris corner detector (from <code>harris.py</code>), then prune them with
    Adaptive Non-Maximal Suppression (ANMS). Harris finds many candidates in textured regions; ANMS keeps strong points that
    are also well-spaced by suppressing those too close to significantly stronger neighbors. Below: before/after ANMS.
  </p>

  <figure class="big">
    <img src="./media/b1_harris_raw.png" alt="B.1 raw Harris corners (no ANMS)">
    <figcaption>Raw Harris corners (no ANMS).</figcaption>
  </figure>

  <figure class="big">
    <img src="./media/b1_anms.png" alt="B.1 ANMS corners overlaid (big)">
    <figcaption>ANMS-selected corners (overlay).</figcaption>
  </figure>

  <!-- ====================== B.2 ====================== -->
  <h2>B.2 — Feature Descriptor Extraction</h2>
  <p>
    Around each ANMS point, I sample a <strong>40×40</strong> window, downsample it with area resampling to <strong>8×8</strong>, and apply
    bias/gain normalization (zero mean, unit variance).
  </p>
  <figure class="big">
    <img src="./media/b2_descriptors.png" alt="B.2 sample 8×8 descriptors (big)">
    <figcaption>Sample normalized 8×8 descriptors visualized as tiles.</figcaption>
  </figure>

  <!-- ====================== B.3 ====================== -->
  <h2>B.3 — Feature Matching (Lowe Ratio)</h2>
  <p>
    I compute all-pairs SSD between descriptors and accept a match if <em>best/second</em> &lt; ratio (Lowe test).
  </p>
  <figure class="big">
    <img src="./media/b3_matches.png" alt="B.3 matched correspondences (big)">
    <figcaption>Accepted matches drawn across concatenated images.</figcaption>
  </figure>

  <!-- ====================== B.4 ====================== -->
  <h2>B.4 — 4-Point RANSAC Homography &amp; Automatic Mosaics</h2>
  <p>
    I run 4-point RANSAC over matches to estimate a robust homography, then adapt Part-A inverse warping + feather blending
    to produce automatic mosaics. Each pair shows the existing manual mosaic and the corresponding automatic one.
  </p>

  <div class="pair">
    <figure class="big">
      <img src="./media/a4_mosaic1.png" alt="A.4 manual mosaic 1 (big)">
      <figcaption>Manual mosaic 1 (from Part A).</figcaption>
    </figure>
    <figure class="big">
      <img src="./media/b4_mosaic1_auto.png" alt="B.4 automatic mosaic 1 (big)">
      <figcaption>Automatic mosaic 1 (RANSAC + auto matches).</figcaption>
    </figure>
  </div>

  <div class="pair">
    <figure class="big">
      <img src="./media/a4_mosaic2.png" alt="A.4 manual mosaic 2 (big)">
      <figcaption>Manual mosaic 2 (from Part A).</figcaption>
    </figure>
    <figure class="big">
      <img src="./media/b4_mosaic2_auto.png" alt="B.4 automatic mosaic 2 (big)">
      <figcaption>Automatic mosaic 2 (RANSAC + auto matches).</figcaption>
    </figure>
  </div>

  <div class="pair">
    <figure class="big">
      <img src="./media/a4_mosaic3.png" alt="A.4 manual mosaic 3 (big)">
      <figcaption>Manual mosaic 3 (from Part A).</figcaption>
    </figure>
    <figure class="big">
      <img src="./media/b4_mosaic3_auto.png" alt="B.4 automatic mosaic 3 (big)">
      <figcaption>Automatic mosaic 3 (RANSAC + auto matches).</figcaption>
    </figure>
  </div>

  <div class="footer">
    <a class="button" href="../index.html">⬅ Back to main page</a>
  </div>
</body>
</html>
